# [BOJ4902 삼각형의 값](https://www.acmicpc.net/problem/4902)

### 난이도

***
G2
<br><br>

### 문제

***
오른쪽 삼각형은 9개의 단위 삼각형이 총 3줄(N=3)로 이루어져 있다. 단위 삼각형은 N=1인 삼각형이다.

이때, 그림에서 서로 다른 부분 삼각형은 총 13개가 있다. (N=1인 삼각형이 9개, N=2인 삼각형이 3개, N=3인 삼각형이 1개)

N = 1인 경우 부분 삼각형은 1개, 2인 경우에는 5개, 3인 경우는 13개, 4인 경우는 27개가 있다.

이때, 단위 삼각형의 값을 삼각형 내부에 쓰여 있는 숫자의 값이라고 하자. 삼각형의 값은 삼각형 안에 있는 단위 삼각형의 값의 합이다.

오른쪽 그림은 가장 큰 값을 갖는 부분 삼각형이다.

삼각형이 주어졌을 때, 가장 큰 값을 갖는 부분 삼각형을 구하는 프로그램을 작성하시오.

![](https://www.acmicpc.net/upload/images/tr.png)
![](https://www.acmicpc.net/upload/images/tr1.png)

<br><br>

### 입력

***
입력은 여러 개의 테스트 케이스로 이루어져 있고, 각 테스트 케이스는 한 줄로 이루어져 있다. 첫 번째 숫자는 줄의 수를 나타내고, 다음 숫자는 단위 삼각형에 적혀있는 값이 위에서 아래, 왼쪽에서 오른쪽 순서대로
주어진다. 마지막 줄에는 0이 주어진다.

줄의 개수는 400을 넘지 않으며, 단위 삼각형에 적혀있는 값의 절댓값은 1000을 넘지 않는다.
<br><br>

### 출력

***
각 테스트 케이스에 대해서, 테스트 케이스의 번호와 가장 큰 부분 삼각형의 값을 출력한다.
<br><br>

#### 예제 입력 1

> 3 6 -24 0 12 -10 12 40 -4 6   
4 1 1 -1 1 1 -1 1 -1 1 1 -1 1 -1 1 -1 1     
0

#### 예제 출력 1

> 1. 54
> 2. 4

<br><br>

### 알고리즘 분류

***

* 브루트포스 알고리즘
* 수학
* 구현
* 누적합
* 깊이 우선 탐색

<br><br>

### Solution

***

이 문제의 핵심은 각 삼각형에 숫자를 부여했을때 그 숫자들의 규칙, 즉 수열을 만들수 있는가가 관건이다.

이 문제는 각 시작 삼각형에서 부터 재귀함수를 이용해서 각 단계의 삼각형의 합들을 구해주었다. 간단하게 재귀함수를 설명하자면

```java
public class Main {
    static void doDFS(int start, int r, int len, int sum, int mode) {
        sum += preSum[start + len - 1] - preSum[start - 1];
        ans = Math.max(ans, sum);
        int nextR = r + mode;
        int nextLen = len + 2;
        int nextStart = start + (2 * r - 1) * mode;

        if (nextR >= 1 && nextR <= N
                && nextStart + nextLen - 1 <= nextR * nextR
                && nextStart >= nextR * nextR - 2 * nextR + 2) {
            doDFS(nextStart, nextR, nextLen, sum, mode);
        }
    }
}
```

1. 우선 각 단계의 재귀함수에서는 같은 행에 존재하는 삼각형들이 가진 숫자들의 합들을 더한다.
2. 다음 재귀함수를 수행할 여부를 정한다.

여기서 다음 재귀 함수를 수행할 여부를 판별하기 위해서는 3가지 조건이 필요하다.

1. 다음 행의 범위가 주어진 N의 값 이내에 존재하는가
2. 다음 행의 시작 삼각형의 번호가 다음 행의 처음 삼각형 번호 이상인가
3. 다음 행의 마지막 삼각형의 번호가 다음 행의 마지막 삼각형 번호 이하인가

이 조건들을 수열로 만들어 보자. 우선 다음 행에서 합을 시작하는 삼각형의 번호를 구하는 수열이다. next = cur + (2 * row -1 ) * mode 여기서 mode 는 역삼각형일때, 즉 다음단계의
재귀함수는 다음 행이 아닌 이전 행으로 진행되는 경우이다.

그래서 다음 행으로 진행될때는 mode = 1, 이전 행으로 수행되는 역삼각형일때는 mode = -1 이 된다. 이 mode 를 이용해서 다음 행을 구하는 식은 nextRow = curRow + mode 가 된다.

다음 행에 존재하는 삼각형 번호의 범위가 필요하다. 여기서 주의할 점이 있다. 처음에 일반 삼각형만 생각했을때 다음 행의 첫번째 삼각형의 번호는 현재 행의 마지막 삼각형의 번호 +1 이 되므로
nextRowFirstCol = curRow * curRow + 1 이라고 생각했다. 하지만 역삼각형일때는 적용되지 않는다. 따라서 다음 행의 열의 범위를 구하는 공식에서 현재 행을 이용하는 것이 아닌 오직 다음
행번호만 이용해서 범위를 구하는 것이 좋다. 실제로 이것때문에 몇번 틀렸다.

우선 다음행의 마지막 열의 삼각형 번호는 당연히 다음 행의 제곱이다. nextRowLastCol = nextRow * nextRow 다음 행의 첫번째 열의 삼각형 번호는 nextRowFistCol = nextRow*
nextRow - (2 * nextRow -1) + 1 이 수식은 수열을 만들어서 점화식을 만들면 쉽게 도출할 수 있는 식이다.       
사실 nextRowFirstCol = (nextRow-1)^2 이다. 즉 nextRow 그 위층에 존재하는 행의 가장 마지막 열의 다음 열이라고 생각하면 이해하기 쉽다.

지금까지 구한 값들을 조건화 시켜서 다음 재귀 함수(doDFS())를 수행할 여부를 위에 말한 3가지 조건을 통해서 판별하면 된다. 그리고 함수를 수행할 때마다 합들을 누적시켜 가장 큰 값을 출력하면 된다.

<br><br>

### [전체 코드](https://github.com/Jungmin-Seo0527/CodingTest/blob/main/src/BruteForce/BOJ4902_삼각형의_값.java)
